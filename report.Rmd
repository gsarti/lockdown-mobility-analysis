---
title: "**Analyzing the Impact of Italy's COVID-19 Lockdown on National Mobility Networks**"
subtitle: "Final project for the Social Network Analysis course"
abstract: "This project aims to analyze shifts in mobility patterns during Italy's COVID-19 lockdown. More specifically, we consider the Italian mobility network for three specific days during the COVID-19 pandemic outbreak: the beginning of the **first local lockdown** in the Lodi province (Feb 25th, 2020), the beginning of **nation-scale lockdown** (March 10th, 2020) and the **end of nation-scale lockdown** at regional level (May 5th, 2020). We perform a diachronic descriptive analysis of the mobility network, we apply community detection algorithms to highlight mobility shifts at a provincial level and we model network connections by the mean of standard and time-aware exponential random graph models (ERGMs) to show the strong connection between mobility shifts and COVID-19 diffusion statistics. We conclude by comparing our results with the mobility reports publicly released by Google and Facebook during the lockdown. Our code is available at [https://github.com/gsarti/lockdown-mobility-analysis](https://github.com/gsarti/lockdown-mobility-analysis)"
author: 
- Gabriele Sarti
- Enrico Fallacara
date: "University of Trieste, Academic Year 2019/2020"
urlcolor: blue
output: 
  pdf_document:
    fig_crop: no
    fig_caption: yes
    includes:
      in_header: header.tex
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.align="center")
source('src/utils.R')
source("src/plot.R")

mobility_pre <- read.csv('data/2020-02-25.csv',sep=";")
mobility_mid <- read.csv('data/2020-03-10.csv',sep=";")
mobility_post <- read.csv('data/2020-05-05.csv',sep=";")

graph_pre <- create_graph_from_data(mobility_pre, metric="n", loops=F, zeros = F)
graph_mid <- create_graph_from_data(mobility_mid, metric="n", loops=F, zeros = F)
graph_post <- create_graph_from_data(mobility_post, metric="n", loops=F, zeros = F)

graph_pre_all <- create_graph_from_data(mobility_pre, metric="n", zeros=F)
graph_mid_all <- create_graph_from_data(mobility_mid, metric="n", zeros=F)
graph_post_all <- create_graph_from_data(mobility_post, metric="n", zeros=F)

line2user <- function(line, side) {
  lh <- par('cin')[2] * par('cex') * par('lheight')
  x_off <- diff(grconvertX(0:1, 'inches', 'user'))
  y_off <- diff(grconvertY(0:1, 'inches', 'user'))
  switch(side,
         `1` = par('usr')[3] - line * y_off * lh,
         `2` = par('usr')[1] - line * x_off * lh,
         `3` = par('usr')[4] + line * y_off * lh,
         `4` = par('usr')[2] + line * x_off * lh,
         stop("side must be 1, 2, 3, or 4", call.=FALSE))
}
```

## Introduction

The nation-level lockdown implemented by the Italian Government to prevent the spreading of the COVID-19 disease in 2020 greatly affected the mobility patterns of roughly 60 million Italian citizens and residents. The Italian lockdown was achieved through a sequence of phases characterized by tightening and loosening of restrictions, with the three most relevant dates being:

- The **first lockdown** of ten municipalities of the province of Lodi, forming the first *zona rossa*, shortly after February 21st, 2020.

- The **national lockdown** that restricted travel at intra-municipal level ( except for working necessities and family emergencies) on the evening of March 9th, 2020.

- The **reopening of inter-regional travel** that took place from May 5th, 2020, after a significant drop in the number of positive cases and daily fatalities.

In this report, we analyze how the Italian mobility trends have shifted during the three phases defined by those dates using a dataset containing raw movements of users of the Facebook platform collected between February and May 2020 at a macro-scale level. We begin by presenting data and preprocessing steps that were taken to perform the analysis in Section  [\textcolor{blue}{1}](#data). Section [\textcolor{blue}{2}](#desc-anal) contains a diachronic descriptive analysis of the mobility network that highlights shared and different properties of the mobility networks through time. In Section [\textcolor{blue}{3}](#comm-det), we highlight mobility shifts at a provincial level by the means of well-established community detection algorithms. Section [\textcolor{blue}{4}](#modeling) depicts our efforts in modeling the mobility network by the means of exponential random graph models (ERGMs) and temporal exponential random graph models (TERGMs) to show the connection between mobility shifts and COVID-19 spreading statistics. We conclude our study in Section [\textcolor{blue}{5}](#conclusion) by summarizing our findings, briefly comparing our results with the mobility reports publicly released by Google during the lockdown and discussing possible extensions of our work.

![Mobility in Italy during the three phases of the Italian lockdown. Left to right: Feb. 25th, March 10th, May 5th. Vertex colors and sizes represent regional membership and total inbound mobility respectively. Edge color intensity expressing mobility strength. Red edges connect provinces belonging to different regions.](img/pre_mid_post.png){#fig:mobility-viz} 

## [1. Data and Preprocessing]{#data}

For our analysis, we leveraged the Movement Range Maps data[^1] published by Facebook on the Humanitarian Data Exchange platform. These data contain movement changes as measured in multiple countries by Facebook during the COVID-19 pandemic. More specifically, we focused only on the data available for the Italian mobility network in three specific dates: February 25th (during Lodi red-zoning), March 10th (first day of national lockdown), and May 5th (first day of national reopening). 

[^1]: https://data.humdata.org/dataset/movement-range-maps

For our analysis, we considered only raw estimated movements at the provincial level and focused mostly on the analysis of **inter-provincial movements**, since they were the most affected by the lockdown procedure: it should be assumed that we are presenting data about inter-provincial movements only except where explicitly stated.  Raw movements metric were chosen as our main metric as they are intrinsically related to the popularity of actors in the mobility network (i.e. Italian provinces), making them especially suited for standard network analysis methodologies. It is important to note that some movements in the dataset were approximated to a null value for privacy reasons: we discarded them since they were not relevant for our macro-analysis of mobility phenomena.

Since the original dataset presents mobility patterns at three moments of the day (12 AM, 8 AM, and 4 PM respectively), we average raw movement values across the three periods to obtain a general mobility measure for each connection between provinces across the entire day. Movement values were generally evenly distributed across various moments of the day, with a slight prevalence of movements at 4 PM for all the inspected days.

## [2. Diachronic Descriptive Analysis of Mobility Networks]{#desc-anal}

<!--The first insight is given by the sum of the movements in these 3 days. We notice that mobility doesn't change much allowing intra-provincial movements, since inter-province connections have values that are much lower than intra-province ones. Thus, removing the loops, allow us to see only inter-province movements and in this case the mobility is significantly lower:

```{r echo = FALSE}
print(paste("Movements (inter-province): Pre", round(sum(E(graph_pre)$weight)), " -> Mid", 
            round(sum(E(graph_mid)$weight)), " -> Post", round(sum(E(graph_post)$weight))))
```
A graphical representation of this phenomenon is given by the next figure.-->

We start our analysis by visualizing the connectivity of the mobility network through time. Figure [\textcolor{blue}{1}](#fig:mobility-viz) presents inter-provincial movements on Italian soil during three crucial moments of the pandemic. In all three cases, mobility networks are **directed**, **weighted** (according to the raw mobility weight value), and **disconnected**.

<!--We restrict our attention to inter-province movements for the descriptive analysis since they capture better the variation of mobility and the results for intra-province are empirically quite similar. The graphs are **directed**, **weighted** (according to the metric value) and **disconnected** (this is valid for both implementations).-->

```{r echo = FALSE, fig.height=2.5, fig.cap="\\label{fig:hist_degree} In-degree and out-degree distribution for nodes for the mobility network of February 25th and May 5th, considering only inter-provincial movements."}
V(graph_pre)$deg <- igraph::degree(graph_pre) 
V(graph_pre)$ideg <- igraph::degree(graph_pre, mode="in")   
V(graph_pre)$odeg <- igraph::degree(graph_pre, mode="out")

V(graph_mid)$deg <- igraph::degree(graph_mid) 
V(graph_mid)$ideg <- igraph::degree(graph_mid, mode="in") 
V(graph_mid)$odeg <- igraph::degree(graph_mid, mode="out")

V(graph_post)$deg <- igraph::degree(graph_post) 
V(graph_post)$ideg <- igraph::degree(graph_post, mode="in") 
V(graph_post)$odeg <- igraph::degree(graph_post, mode="out")

par(mfrow=c(1,4))
hist(get_attr(graph_pre, "ideg", "vertex"), xlab ="In-Degree distribution", ylab="# of Provinces", breaks=10, ylim=c(0,45), main="")
hist(get_attr(graph_pre, "odeg", "vertex"), xlab ="Out-Degree distribution", ylab="# of Provinces", breaks=10, main="")
text(line2user(line=mean(par('mar')[c(2, 2)]), side=2), 
     line2user(line=2, side=3), 'February 25th Mobility', xpd=NA, cex=1, font=2)
hist(get_attr(graph_post, "ideg", "vertex"), xlab ="In-Degree distribution", ylab="# of Provinces", breaks=8, ylim=c(0,45), xlim=c(0,20), main="")
hist(get_attr(graph_post, "odeg", "vertex"), xlab ="Out-Degree distribution", ylab="# of Provinces", breaks=10, ylim=c(0,40), xlim=c(0,25), main="")
text(line2user(line=mean(par('mar')[c(2, 3)]), side=2), 
     line2user(line=2, side=3), 'May 5th Mobility', xpd=NA, cex=1, font=2)
```

The decrease in total mobility throughout the lockdown period affected the south-eastern and insular regions of Italy in particular, with most intra-regional connections being dropped after the first lockdown phase. On the other hand, provinces in Lombardy, Tuscany, Veneto, Emilia-Romagna, Lazio, and Campania are the least affected. As of May 5th, the Italian mobility network still seems heavily impacted by the lockdown and shows no apparent signs of regeneration.

We proceed by analyzing the in-degree and the out-degree distribution of actors. Figure [\textcolor{blue}{2}](#fig:hist-degree) highlights the fact that a majority of nodes have a degree ranging between 1 and 10, with few nodes assuming larger values. We can notice that, concerning in-degree, large values tend to vanish and the distribution concentrates on small values, indicating that nodes lose their popularity throughout the pandemic. The same happens to the out-degree distribution, indicating that the expansiveness of nodes is also affected.

Table [\textcolor{blue}{1}](#tab:descriptive_analysis) presents a summary of multiple descriptive measures of the mobility network through time. Low values assumed by **network density** indicate that the graph is **sparse** at all times, but the slight decrease through time seems to support the decrease in overall movements we first presented in Figure [\textcolor{blue}{1}](#fig:mobility-viz). We can also observe that the decrease over time in all edge-related values (# movements, # edges, dyad counts, triangles) is related to an increase in the longest geodesic (i.e. the diameter, computed over inverted raw movements). This can be interpreted as provinces becoming increasingly loosely-knit through the pandemic.

For what concerns the **assortativity by degree**[@newman2002assortative] measure, we can see that its value for the network increases through time, starting at $0.134$ on February 25th and reaching a value of $0.326$ on May 5th. Since the measure indicates the tendency of nodes having a similar degree to connect, this could indicate a clustering of movements across provinces of the same size, reducing the movement from small to large ones.

Table [\textcolor{blue}{1}](#tab:descriptive_analysis) shows how **transitivity** measures for the whole network tend to stay roughly the same through the lockdown phases. Thus, to inspect better this property, we calculate this measure on two subgraphs obtained placing a $\text{threshold}_w = 500$ on edge weights, i.e. considering only connections among provinces that see at least 500 raw movements in a portion of the day. The threshold value was selected by looking at the distribution of weights in the network, noticing that most edges have weights between $0$ to $500$. The subgraphs of nodes below the threshold show a transitivity value (Transitivity sub. lower) that is slightly smaller than the global value and hardly varies through time. On the other hand, the subgraph containing only edges above $\text{threshold}_w$ shows a significant increment of $0.10$ in its transitivity value (Transitivity sub. upper). This can be interpreted as the tendency of big provinces to increase their number of connections throughout the three phases of the lockdown. Transitivity was also computed for the $k$-cores of the graph, where $k=8$ is the minimum value between the coreness values for the three networks (note that only the Feb. 25th network has a value of $k$ bigger than the one we selected, with coreness equal to $10$). The transitivity calculated on these maximal subgraphs has a significant decrease of $0.18$, as we expected, indicating that these subnetworks underwent a significant loss in terms of cohesion through time.

\begin{table}
\begin{center}
\begin{tabular}{l@{\qquad}ccc@{\qquad}ccc}
\toprule
& \multicolumn{1}{c}{\textbf{Feb. 25th}} & \multicolumn{1}{c}{\textbf{Mar. 10th}} & \multicolumn{1}{c}{\textbf{May 5th}} \\
\midrule
\# of provinces & 110 & 110 & 110 \\
\# of edges & 600 & 478 & 434 \\
\# of movements & 119065 & 85258 & 68515 \\
\% mobility decrease & - & 30\% & 43\% \\
\midrule
Density & .050 & .040 & .036 \\
Diameter & .306 & .506 & .843 \\
Dyad census (MAN) & 279/42/5674 & 230/18/5747 & 206/22/5767 \\
\# of triangles & 918 & 492 & 423 \\
Assortativity by degree & .134  & .251  & .326 \\
\midrule
Global transitivity & .386  & .405 & .417  \\
Transitivity sub. upper & .171  & .206 & .272 \\
Transitivity sub. lower & .315  & .317  & .345  \\
Transitivity k-cores & .796 & .613 & .611 \\
\bottomrule
\end{tabular}
\caption{Descrpitive analysis of the mobility network at different times of the Italian lockdown. The sharp decrease in network connectivity leads to increased assortativity and transitivity measures. The diameter is computed using inverted edge weights ($1/\text{raw movements}$) as proxies for distance in communication.}
\label{tab:descriptive_analysis}
\end{center}
\end{table}

We conclude our descriptive analysis of the network by inspecting node importance by the means of multiple centrality indices. Since centrality measures treat edge weights as distances and not as connection strengths, weights need to be inverted in a fashion similar to the diameter computation in Table [\textcolor{blue}{1}](#tab:descriptive_analysis). We follow an approach suggested in the literature[@ozyer2019social], converting our raw movement weights $w$ into rescaled inverted movement weights $w'$ that can be used as proxies for distances.

$$w' = \frac{1}{w}\times 10'000$$

We proceed by calculating the **weighted betweenness**[@Barrat2004BTW] scores and the **eigenvector centrality** for nodes in the mobility network, leaving closeness for later since the network is disconnected.

Betweenness remains practically the same in all graphs, besides a few small variations. However, regions of Lazio, Umbria, and Abruzzo show an interesting trend where Rome, which has the largest value among neighboring provinces, suffers a decrease in betweenness through time while the betweenness of its neighbors increases. Appendix [\textcolor{blue}{A}](#app:betweenness) visualizes this trend. This could indicate that Rome's tendency to influence movements (flows) is slightly lost in favor of its neighbors, a situation that can be motivated by the sudden shift towards remote work.

**Eigenvector centrality** distribution shows that a loss of network influence for northern and southern provinces, while in central Italy the situation remains almost completely unchanged, despite a slight decrease in values. [\textcolor{blue}{B}](#app:eigenvector_centrality) visualizes this trend. We speculate that this can be a direct consequence of northern provinces being the most affected by the pandemic.

We finally compute the **global clustering coefficient** to quantify network cohesion, both **globally**, on **subgraphs** above $\text{threshold}_w$ and on **k-cores components** of original graphs with $k=8$.

To summarize, the decrease of movements caused by lock-down measures causes a loss of influence of the nodes in the whole network, with an increasing tendency of similar degree nodes to connect, indicating that movements from small provinces to large ones decrease in favor of smaller and geographically-closer provinces. The opposite happens for large provinces, with an increase in assortativity reflecting a decrease in mobility from large to small provinces reduce in favor of movements among large ones.

```{r echo = FALSE, fig.height=3.5, fig.cap="\\label{fig:histo_mobility} Distribution of inbound strength $s$ across provinces at various stages of the Italian lockdown, considering inter-provincial movements only (top) and all movements (bottom). Left to right: February 25th, March 10th, May 5th mobility."}
par(mfrow=c(2,3), mai=c(0.5,0.3,0.3,0.3))
xlab <- 'Inbound strength'
attr <- 'in_strength'
type <- 'vertex'
breaks <- 15
pre_attr <- get_attr(graph_pre, attr, type)
mid_attr <- get_attr(graph_mid, attr, type)
post_attr <- get_attr(graph_post, attr, type)
hist(pre_attr, xlab = xlab, ylab="# of Provinces", main="", breaks=breaks)
hist(mid_attr, xlab = xlab, ylab="# of Provinces", main="", breaks=breaks, ylim=c(0,80), xlim=c(0,12000))
hist(post_attr, xlab = xlab, ylab="# of Provinces",main="", breaks=breaks, ylim=c(0,80), xlim=c(0,12000))
pre_attr <- get_attr(graph_pre_all, attr, type)
mid_attr <- get_attr(graph_mid_all, attr, type)
post_attr <- get_attr(graph_post_all, attr, type)
hist(pre_attr, xlab = xlab, ylab="# of Provinces",main="", breaks=breaks, ylim=c(0,80), xlim=c(0,300000))
hist(mid_attr, xlab = xlab, ylab="# of Provinces", main="", breaks=breaks, ylim=c(0,80), xlim=c(0,300000))
hist(post_attr, xlab = xlab, ylab="# of Provinces", main="",breaks=breaks, ylim=c(0,80), xlim=c(0,300000))
```

## [3. Analyzing Mobility Communities]{#comm-det}

We define **inbound strength** $s$ as the sum of the weights of inbound directed edges (movements) to each node (province). Intuitively, it can be regarded as a proxy for the importance of the node inside the network. Figure [\textcolor{blue}{3}](#fig:histo_mobility) shows that movements across provinces follow a power law that is typical for large networks, with very few provinces accounting for most of the movements. We see from the histograms that the value of $s$ is much higher when accounting for intra-provincial movements. This is also evident in the visualizations of Appendix [\textcolor{blue}{B}](#app:eigenvector_centrality), where this value is used to weight edge widths. While total movements don't seem to be affected, Table [\textcolor{blue}{1}](#tab:descriptive_analysis) shows a large drop of 30% in inter-provincial movements between February 25th and March 10th, with a further 13% decrease in mobility between March 10th and May 5th. These percentages match our intuition that inter-provincial mobility suffered the most from lockdown measures.

We proceeded to compute and visualize the coreness of the network, as shown in Appendix [\textcolor{blue}{C}](#app:coreness). As expected, removing intra-provincial movements (looping edges) doesn't affect at all the coreness structure. From the coreness plots structure, it is evident how north-eastern, southern, and insular provinces have a much lower number of connections when compared to central (e.g. Tuscany) and north-western (e.g. Lombardy, Piedmont) ones. Calabrian and Sardinian provinces have the lowest number of connections.

To account for the intrinsically weighted structure of our networks, we developed a **weighted version of the coreness algorithm** that groups vertices in bins of fixed length based on their weights and uses bin membership as a proxy for weighted coreness. In our specific case, we used a bin size $b$ of 500 raw movements for the network without intra-provincial movements, and 10'000 for the network containing all movements. The details of our implementation are presented in Algorithm [\textcolor{blue}{1}](#alg:weighted-coreness). This method is equivalent to the one proposed by [@Garas_2012] with node degree weights $\beta$ set to $0$. We see from the results shown in Appendix [\textcolor{blue}{D}](#app:wcoreness) that our approach effectively highlights the centrality of northwestern provinces when we account only for inter-provincial movements, while it shows a strong correlation with population counts when accounting for all external and internal movements in the province.

\begin{algorithm}
\SetAlgoLined
\DontPrintSemicolon
 \textit{Input:} Network $\mathcal{G}(V_G,E_G)$, strenght bin size $b$\;
 Set current weighted k-core subgraph $\mathcal{K}(V_k, E_k) \leftarrow \mathcal{G}$\;
 Set max inbound strength $S \leftarrow \max{(\text{strength}(V))}$\;
 Set index $i \leftarrow 1$\;
 \For{min in $b, 2b, 3b,\dots S$}{
    Create bin graph $\mathcal{B}(V_B,E_B) \leftarrow \text{Induced subgraph}(\mathcal{K}, \text{ strength}\small(V_k\small) \leq min)$\;
    \If{$|V_B| > 0$}{
        Set \textit{wcore} of $V_G$ that were not filtered in $\mathcal{B}$ to $i$\;
        $\mathcal{G}(V_B \cap V_G)[wcore] \leftarrow i$\;
        $i \leftarrow i+1$\;
    }
    Set current weighted k-core subgraph to the complement of bin graph\;
    $\mathcal{K} \leftarrow \text{Induced subgraph}(\mathcal{K}, \text{ strength}\small(V_k\small) > min)$\;
 }
 \textit{Output:} Network $\mathcal{G}(V_G,E_G)$ with \textit{wcore} vertex attributes\;
 \caption{Weighted Coreness}
 \label{alg:weighted-coreness}
\end{algorithm}

For the second part of the community analysis, we proceeded only with the network of inter-provincial movements since the presence of looping edges wasn't relevant for detecting communities inside the network. We further inspected the component structure of the network in the three analyzed dates, finding that a single giant component comprising almost all the provinces, with few isolated nodes left aside in Southern Italy, was present at all times. This isn't surprising, as we expect some level of communication at a national level at all times for business and family-related reasons despite the lockdown.

In Appendix [\textcolor{blue}{E}](#app:components) we show the similarity between the structure of cliques through time and the components found by considering network actors with weighted coreness rank $> 2$, i.e. with at least $1000$ inter-provincial outbound movements at all times. This highlights the fact that most tight-knit communities are also the ones having a higher number of connections in general, reflecting the principle of preferential attachment which is commonly verified in many real-world complex networks. This fact is also verified by the presence of a **small-worldness index**[@humphries2008smallworld] above $3$ at all times, and global transitivity that is significantly above chance. Both cliques and weighted coreness components highlight the **centrality of Milan** and its neighbors, Tuscany provinces, and the Rome-Naples macro-region. Weighted coreness components further provide additional information by highlighting the high connectivity of Veneto and representing well the drop in connectivity during the lockdown.

As the last step of our community analysis, we performed some community detection experiments leveraging two well-established algorithms. The **Girvan-Newman algorithm** finds communities by progressively removing edges based on their betweenness.
The **label propagation algorithm**, instead, iteratively sets node community memberships based on the weighted most common membership across neighboring nodes until convergence. While Girvan-Newman method considers distances as costs, thus forcing us to leverage *inverted movement weights* $w'$ presented in Section [\textcolor{blue}{2}](#desc-anal), the label propagation approach doesn't require inverting raw movements weights $w$ since larger edge weights correspond to stronger connections. Results produced by the two methods are presented descriptively in Table [\textcolor{blue}{2}](#tab:clustering) and visually in Appendix [\textcolor{blue}{F}](#app:clustering). We could not apply standard multi-level modularity optimization methods given the directed nature of our network, but label propagation achieves significantly higher modularity scores.

\begin{table}
\begin{center}
\begin{tabular}{l@{\qquad}ccc@{\qquad}ccc}
\toprule
 & \multicolumn{3}{c}{\textbf{Girvan-Newman}} & \multicolumn{3}{c}{\textbf{Label Propagation}} \\
 \cmidrule(lr){2-4}
 \cmidrule(lr){5-7}
& \multicolumn{1}{c}{\textbf{Feb. 25th}} & \multicolumn{1}{c}{\textbf{Mar. 10th}} & \multicolumn{1}{c}{\textbf{May 5th}} & \multicolumn{1}{c}{\textbf{Feb. 25th}} & \multicolumn{1}{c}{\textbf{Mar. 10th}} & \multicolumn{1}{c}{\textbf{May 5th}} \\
\midrule
\# communities & 36 & 60 & 7 & 22 & 22 & 24\\
modularity $Q$ & .39 & .25 & .39 & .51 & .57 & .59 \\
\midrule
$\delta_{int}$ & .19 (.38) & .12 (.31) & .54 (.37) & .78 (.21) & .68 (.25) & .73 (.23) \\
$\delta_{ext}$ & .07 (.05) & .08 (.04) & .01 (.01) & .04 (.03) & .03 (.01) & .03 (.01) \\
Gini index & .96 (.18) & .97 (.14) & .66 (.37) & .78 (.22) & .76 (.22) & .80 (.21) \\
\bottomrule
\end{tabular}
\caption{Values of the metrics computed using two community detection approaches. Values for intra-cluster density $\delta_{int}$, inter-cluster density $\delta_{ext}$ and Gini index are presented in the \textit{mean (stdev)} format.}
\label{tab:clustering}
\end{center}
\end{table}

Label propagation seems to be more effective for modeling the community structure of the networks. Communities found with label propagation closely approximate regional membership at all times, a fact that matches the empirical presence of regional hubs of communication across the Italian territory. It is worth noting that both algorithms correctly highlight a decrease in inter-community edges over time, which is also evident given the drastic reduction in red inter-cluster edges in Appendix [\textcolor{blue}{F}](#app:clustering) plots.

To summarize, in this section we further highlighted the presence of tight-knit, well-connected communities in northern and central regions of Italy, showing how inter-provincial movements and inter-regional movements were by far the most affected by the lockdown procedure.

## [4. Modeling Mobility Patterns]{#modeling}

The final section of our report concerns our ability to model the mobility network structure using **exponential random graphs (ERGMs)** and their **temporal variant (TERGMs)**. To achieve a better quality of fit on our networks, we decided to complement our mobility patterns with some **auxiliary data** that can provide additional useful information to the model. More specifically, we leverage the two following data sources:

- **Province d'Italia** data taken from Wikipedia[^2], that contains informations about **population**, **population density**, **surface** and **municipalities** at provincial level.

[^2]: https://it.wikipedia.org/wiki/Province_d%27Italia

- **COVID-19 Italy** data taken from the Protezione Civile official Github repository[^3], which contains information about the number of **COVID cases** at province level and the number of **COVID-related fatalities** at regional level. We associate regional mortality to each province following the intuition that the perception of danger for individuals of each province can be estimated by looking at regional data.

[^3]: https://github.com/pcm-dpc/COVID-19

These variables are chosen because they can be significant in our analysis, as they have a strong connection with movements between the different regions and/or provinces.

After adding these variables, we start by specifying and estimating three ERGM models, one for each analyzed day. Our approach to obtaining the best possible model is inspired by the `stepAIC` function, which performs backward model selection by starting from a model and iteratively optimizing AIC scores by trimming down the less relevant feature at each step. The final model contains only significant variables: we finally select the one that has the lowest AIC value among all possible configurations. All models were fit using Markov Chain Monte Carlo simulations (MCMC)

The three final models are:

```{r,eval=FALSE, echo = TRUE}
mod.feb <- ergm(feb.net ~ edges + mutual + nodematch('region', diff=F) + nodecov('ideg') + 
                    nodecov('out_strength'))
mod.mar <- ergm(mar.net ~ edges + mutual + nodematch('region', diff=F) + nodecov('odeg'))
mod.may <- ergm(may.net ~ edges + mutual + nodematch('region', diff=F) + nodecov('ideg') + 
                    nodecov('eig_vect_centr') + nodecov('covid_deaths'))
```

All the three models use information about the number of edges, mutuality (number of pairs of actors $i$ and $j$ for which
$(i \to j)$ and $(j \to i)$ both exist) and homophilic relations given by the regional match in model factors. The first two models don't leverage COVID-19 statistics; we argue that it is reasonable since for early dates we could not foresee the real epidemic extent on the Italian territory except for some specific regions (e.g. Lombardy and Veneto). Instead, the third model shows the relevance of the COVID death factor, using also eigenvector centrality as a proxy for node importance. We argue that those two factors are important when taken together since central provinces with high mortality rates were nonetheless able to keep strong connections with their neighbors, while more secluded ones couldn't (e.g. Milan vs. Trento) 

It is relevant to note that models show some sort of *performance decay*, where the goodness goodness-of-fit diagnostics for the MCMC procedure worsen over time for different configurations, despite remaining quite acceptable for our purposes. We interpret this as a hint to the inadequacy of individual ERGMs for modeling the evolution of a network through time and proceed to use **temporal ERGMs** to look for better solutions.

### [4.1 Mobility Patterns Through Time]{#tergms}

Moving from static snapshots of mobility in Italy to a dynamic mobility network is highly desirable since it allows us to focus our analysis on **tie dynamics** (both formation and dissolution of edges) and **attribute dynamics** (e.g. change in nodes inbound and outbound strengths). For this purpose we use the `networkDynamic` package in R to convert our three static mobility networks into a single dynamic network with three discrete timesteps, we model the temporal network using the `tergm` package[^4] and we visualize our results with `ndtv`[^5]. Since our analysis is restricted only to the three selected dates, this aims to be a superficial proof-of-concept more than a full-fledged analysis.

[^4]:http://statnet.org/Workshops/tergm_tutorial.html
[^5]:http://statnet.org/Workshops/ndtv_workshop.html

The `stergm` function we use for temporal network modeling allows us to find **separable temporal ERGMs (STERGMs)**[@KrivitskyHandcock2014STERGM] that closely describe the temporal dynamics of our network. STERGM comprise two models: one for **tie formation**, and one for **tie dissolution**. Models are separable in the sense that factors influencing tie formation can be different from those influencing dissolution in the network, and closely match the normal ERGMs except added time indices, conditionals on the previous existence of ties and individual $\theta$ and $g$ parameters for each model. The `tergm` tutorial in the footnotes provides a more formal and comprehensive presentation of this approach.

We use the **conditional maximum likelihood estimation (CMLE)** fitting approach since we are interested in modeling the transition between networks that represent discrete time points. Our best selected model, obtained with the same approach as the ERGM ones in the previous sections, has the following form:

```{r,eval=FALSE, echo = TRUE}
mob.nets <- list(feb.net, mar.net, may.net)
stergm.fit <- stergm(mob.nets, 
                     formation= ~ edges + gwesp(0.25, fixed=T) + mutual +
                        nodecov('eig_vect_centr') + nodematch('region', diff=F),
                     dissolution = ~ edges + mutual + nodecov('covid_deaths') +  
                         nodecov('pop_density') + edgecov('length_km') +
                         edgecov('weight'),
                     targets="formation", estimate = "CMLE")
```

Table [\textcolor{blue}{3}](#tab:ergm_fit) shows the coefficient values and the goodness-of-fit metrics for the three ERGM models and the TERGM subcomponents. We observe here how covariates in models closely fit our intuition about mobility dynamics: nodes with same regional membership, which are already connected by their neighbors (mutuality, `gwesp` as a more robust version of `triangles`) and are more central (eigen. centrality) and strongly connected (edge weight, in-degree, out-degree) are much more likely to be connected by an edge in the future. On the other hand, COVID deaths, population density, and distance have all a negative impact on the likelihood of edge formation (i.e. positively affect edge dissolution), as can be seen from May 5th and TERGM Dissolution models.

We validate our procedure using MCMC diagnostic plots and visualizing the goodness of fit for our covariates. We don't report diagnostic plots for brevity, but all show a reasonable sampling behavior. Appendix [\textcolor{blue}{G}](#app:gof_tergm) reports goodness-of-fit plots obtained from our TERGM formation model, closely matching the empirical distribution of covariates in our network. By performing a dynamic simulation of the network for $n=10$ time steps we observe how the behavior of the simulated mobility network closely matches real-world behavior, with the disconnection of insular and southern provinces and an overall increase in the diameter of the network.

\begin{table}
\begin{center}
\begin{tabular}{l@{\qquad}ccc@{\qquad}cc}
\toprule
 & \multicolumn{3}{c}{\textbf{ERGMs}} & \multicolumn{2}{c}{\textbf{TERGM}} \\
 \cmidrule(lr){2-4}
 \cmidrule(lr){5-6}
& \multicolumn{1}{c}{\textbf{Feb. 25th}} & \multicolumn{1}{c}{\textbf{Mar. 10th}} & \multicolumn{1}{c}{\textbf{May 5th}} & \multicolumn{1}{c}{\textbf{Generation}} & \multicolumn{1}{c}{\textbf{Dissolution}} \\
edges & $-6.92^{***}$ & $-7.50^{***}$ & $-7.64^{***}$ & $-9.62^{***}$ & $-2.36^{***}$ \\
mutual & $7.21^{***}$ & $8.69^{***}$ & $8.15^{***}$ & $4.17^{***}$ & $3.31^{***}$ \\
gwesp fix 0.25 & - & - & - & $0.92^{**}$ & - \\
\midrule
in-degree & $0.11^{***}$ & - & $1.76^{***}$ &- & -  \\
out-degree & - & $0.10^{***}$ & - & - & - \\
eigen. centrality & - & - & $-0.43^{***}$ & $1.40^{*}$ & - \\
\midrule
region & $2.31^{***}$ & $2.18^{***}$ & $2.36^{***}$ & $2.89^{***}$ & - \\
pop. density & - & - & - & - & $-3_{e-4}^{*}$ \\
covid deaths & - & - & $-3.95_{e-5}^{***}$ & - & $-1_{e-3}^{.}$\\
\midrule
edge weight & - & - & - & - & $.08^{***}$ \\
edge length (km) & - & - & - & - & $4_{e-3}^{***}$ \\
\midrule
AIC & 1795 & 1360 & 1293 & 174.1 & 416.8 \\
BIC & 1831 & 1390 & 1338 & 214.3 & 446.7 \\
\bottomrule
\end{tabular}
\caption{Quality estimators (AIC \& BIC) and covariate coefficients (rest) for the three ERGM models fit on individual time slices and TERGM generation and dissolution models fit on the dynamic mobility network. Signif. codes:  *** 0.001 ** 0.01 * 0.05 . 0.1. We use subscript notation for negative exponents.}
\label{tab:ergm_fit}
\end{center}
\end{table}

## [5. Discussion and Conclusion]{#conclusion}

To summarize the totality of our work, our analysis of the Italian mobility network during three separate moments of the 2020 lockdown procedure highlights the decrease of movements caused by lock-down measures, both in absolute terms of total raw movement counts and in relative terms of movement paths across provinces. We point out an increasing propensity towards assortativity during the lockdown, with movements between similar provinces being the least affected by the government directives. The tight-knit, well-connected communities found by the means of two clustering methods support these findings, showing how inter-regional movements were the most affected by the lockdown procedure. Covariates in our models of the mobility network, especially in the case of TERGMs, reflect how nodes with the same regional membership are much more likely to be connected by an edge in the future, while geographical distances, COVID death estimates and population densities all hurt mobility patterns across provinces.

We conclude by comparing our results with **Google Global Mobility Report**[^4], which measures daily visitors counts for specific location categories (e.g. train stations, workplaces, residential areas) and compares shifts in mobility as variations relative to a baseline day before the pandemic outbreak. Focusing on the Italy report, we can see that the reduction of movements towards workplaces estimated for May 5th (46%) is very similar to the results obtained from our mobility network (43%, from Table Table [\textcolor{blue}{1}](#tab:descriptive_analysis)). We believe that the coherence in empirical observations of mobility phenomena acts as further support to the validity of our findings.

This report was by no means intended to cover all the interesting phenomena underlying such monumental shifts in mobility trends and wanted to act as a self-contained starting point complete with reproducible code to analyze such data. As for possible extensions of our work on Italy's mobility during the lockdown, we deem as interesting the possibility of extending the temporal modeling of the mobility network to the encompass the whole duration of the pandemic, given the fine granularity of open mobility data released by Facebook. We believe this research might be interesting to better understand the behavior of the Italian mobility network, and possibly make it more robust to counter future adversities.

[^6]: https://www.google.com/covid19/mobility/

\newpage

# References

<div id="refs"></div>

\blandscape

# [Appendix]{#appendix}

## [A. Shift in Betweenness Across Regions of Central Italy]{#app:betweenness}

\vspace{5mm}

\begin{figure}
\begin{center}
\includegraphics{img/btw_regions.png}
\caption{From left to right: Feb. 25th, March 10th, and May 5th mobility situation of provinces belonging to the regions of Lazio, Umbria, and Abruzzo. Edge size represents the number of raw movements, while vertex size represents the betweenness of nodes in the total network.}
\end{center}
\end{figure}

\newpage

## [B. Shift in Provinces Influence on Mobility During Italy Lockdown]{#app:eigenvector_centrality}

\vspace{5mm}

\begin{figure}
\begin{center}
\includegraphics{img/eig_vect_italy.png}
\caption{From left to right: Feb. 25th, March 10th, and May 5th mobility for provinces on the whole territory. Edge size represents the number of raw movements, while vertices sizes and colors represent the eigenvector centrality and the regional membership of nodes in the network.}
\end{center}
\end{figure}

\newpage

## [C. Coreness in February 25th Mobility Network]{#app:coreness}

\vspace{5mm}

\begin{figure}
\begin{center}
\includegraphics{img/coreness.png}
\caption{Circular plot representing coreness values of provinces in the mobility network for February 25th, respectively for inter-provincial movements only (left) and all movements (right). Provinces colors reflect regional membership, with provinces closer to the center having higher coreness values.}
\end{center}
\end{figure}

\newpage

## [D. Weighted Coreness in February 25th Mobility Network]{#app:wcoreness}

\vspace{5mm}

\begin{figure}
\begin{center}
\includegraphics{img/weighted_coreness.png}
\caption{Circular plot representing weighted coreness values of provinces in the mobility network for February 25th, respectively for inter-provincial (left) and all movements (right). Provinces colors reflect regional membership, with more central provinces having higher weighted coreness values.}
\end{center}
\end{figure}

\newpage

## [E. Connected Components and Cliques During Lockdown]{#app:components}

\vspace{5mm}

\begin{figure}
\begin{center}
\includegraphics{img/comp_cliques.png}
\caption{Left to right: Connected components in subnetwork with weighted coreness rank $> 2$ (top) and largest cliques (bottom) for February 25th, March 10th, May 5th mobility networks. Nodes are colored depending on their component and clique belonging respectively.}
\end{center}
\end{figure}

\newpage

## [F. Mobility Communities using Girvan-Newman and Label Propagation Algorithms]{#app:comm_det_plots}

\vspace{5mm}

\begin{figure}
\begin{center}
\includegraphics{img/clustering.png}
\caption{Left to right: Communities highlighted by the Girvan-Newman (top) and the Label Propagation (bottom) clustering algorithms for February 25th, March 10th, May 5th mobility networks. Node and regions' colors reflect community membership, red edges show inter-community mobility.}
\end{center}
\end{figure}

\newpage

## [G. Goodness of Fit for Mobility Network's TERGM]{#app:gof_tergm}

\vspace{5mm}

\begin{figure}
\begin{center}
\includegraphics[width=640px, height=500px]{img/gof_tergm.png}
\caption{Goodness of fit visualization for the formation (top) and the dissolution (bottom) components of TERGM model on Italy mobility network.}
\end{center}
\end{figure}

\elandscape